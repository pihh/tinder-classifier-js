<head>
  <link rel="stylesheet" href="public/style.css" />
</head>
<body>
  <div>
    <img id="image" />
  </div>
  <div>
    <button id="dislike" class="btn btn-danger">Dislike</button>
    <button id="like" class="btn btn-primary">Like</button>
  </div>

  <script>
    lock();
    (function() {
      fetch("classifier-render")
        .then(response => response.json())
        .then(data => {
          next(data);
        });
    })();

    function lock() {}

    function unlock() {}

    function like() {
      lock();
      fetch("classifier-like")
        .then(response => response.json())
        .then(data => {
          next(data);
        });
    }

    function dislike() {
      lock();
      fetch("classifier-dislike")
        .then(response => response.json())
        .then(data => {
          next(data);
        });
    }

    function next(data = {}) {
      if (data.success) {
        unlock();
        document.getElementById("image").src =
          "/images/unclassified/" + data.data;
        return;
      }
      alert("No more images, will scrape for more and try run again");

      fetch("scrape")
        .then(response => response.json())
        .then(() => {
          fetch("classifier-render")
            .then(_response => _response.json())
            .then(_data => {
              next(_data);
            });
        });
    }

    // bind key press listeners
    document.addEventListener("keyup", function(event) {
      if (event.defaultPrevented) {
        return;
      }

      var key = event.key || event.keyCode;
      // console.log({ key });

      switch (key) {
        case "ArrowLeft":
          dislike();
          break;

        case "ArrowRight":
          like();
          break;
      }
    });
  </script>
</body>
